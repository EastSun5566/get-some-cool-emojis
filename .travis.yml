language: node_js

node_js:
  - lts/*

cache: yarn

jobs:
  include:
    - stage: Test
      script: yarn test

    - stage: NPM publish
      if: (tag =~ ^v) AND (branch = master)
      script: yarn build
      deploy:
        provider: npm
        email: michael19920327@gmail.com
        api_key: $NPM_TOKEN
        skip_cleanup: true
        on:
          tags: true

    - stage: Demo deploy
      if: (tag =~ ^v) AND (branch = master)
      script: yarn release
      deploy:
        provider: pages
        script: yarn deploy
        github_token: $GITHUB_TOKEN
        skip_cleanup: true
        on:
          tags: true
